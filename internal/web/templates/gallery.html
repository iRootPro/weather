{{template "base.html" .}}

{{define "title"}}–§–æ—Ç–æ–≥–∞–ª–µ—Ä–µ—è - –ú–µ—Ç–µ–æ—Å—Ç–∞–Ω—Ü–∏—è{{end}}

{{define "content"}}
<div class="space-y-6">
    <!-- Header -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6 transition-colors">
        <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-2">–§–æ—Ç–æ–≥–∞–ª–µ—Ä–µ—è</h2>
        <p class="text-sm text-gray-500 dark:text-gray-400 mb-3">
            –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ –ø–æ–≥–æ–¥–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º
        </p>

        <!-- Info about adding photos -->
        <div class="mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
            <div class="flex items-start gap-2">
                <svg class="w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.446 1.394c-.14.18-.357.295-.6.295-.002 0-.003 0-.005 0l.213-3.054 5.56-5.022c.24-.213-.054-.334-.373-.121l-6.869 4.326-2.96-.924c-.64-.203-.658-.64.135-.954l11.566-4.458c.538-.196 1.006.128.832.941z"/>
                </svg>
                <div class="flex-1">
                    <p class="text-sm font-medium text-blue-900 dark:text-blue-200">
                        –•–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–µ —Ñ–æ—Ç–æ?
                    </p>
                    <p class="text-xs text-blue-700 dark:text-blue-300 mt-1">
                        –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é –≤ –Ω–∞—à <a href="https://t.me/ArmavirMeteoBot" target="_blank" class="underline hover:no-underline font-medium">Telegram –±–æ—Ç</a> ‚Äî –æ–Ω–∞ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ –ø–æ–≥–æ–¥–µ!
                    </p>
                </div>
            </div>
        </div>
    </div>

    {{if .Data}}
    {{$photos := .Data}}
    <!-- Photo Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        {{range $photos}}
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden transition-all hover:shadow-xl cursor-pointer"
             onclick="openPhotoModal({{.ID}})">
            <!-- Image -->
            <div class="relative aspect-w-16 aspect-h-12 bg-gray-100 dark:bg-gray-700">
                <img src="/photos/{{.Filename}}"
                     alt="{{.Caption}}"
                     class="w-full h-64 object-cover"
                     loading="lazy">
                {{if .Caption}}
                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-4">
                    <p class="text-white text-sm font-medium line-clamp-2">{{.Caption}}</p>
                </div>
                {{end}}
            </div>

            <!-- Info -->
            <div class="p-4">
                <div class="flex items-center text-sm text-gray-500 dark:text-gray-400 mb-2">
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                    {{formatTime .TakenAt "02.01.2006 15:04"}}
                </div>
                {{if .AuthorName}}
                <div class="flex items-center text-sm text-gray-500 dark:text-gray-400 mb-2">
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                    </svg>
                    {{.AuthorName}}
                </div>
                {{end}}

                {{if .Temperature}}
                <div class="flex items-center gap-3 text-sm">
                    <span class="text-gray-600 dark:text-gray-300">
                        üå°Ô∏è {{printf "%.1f" (deref .Temperature)}}¬∞C
                    </span>
                    {{if .Humidity}}
                    <span class="text-gray-600 dark:text-gray-300">
                        üíß {{printf "%.0f" (deref .Humidity)}}%
                    </span>
                    {{end}}
                </div>
                {{end}}
            </div>
        </div>
        {{end}}
    </div>

    {{else}}
    <!-- Empty State -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-12 text-center">
        <svg class="w-24 h-24 mx-auto text-gray-300 dark:text-gray-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
        </svg>
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</h3>
        <p class="text-gray-500 dark:text-gray-400 mb-4">
            –°—Ç–∞–Ω—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –¥–æ–±–∞–≤–∏—Ç —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é!
        </p>
        <a href="https://t.me/ArmavirMeteoBot" target="_blank" class="inline-flex items-center gap-2 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.446 1.394c-.14.18-.357.295-.6.295-.002 0-.003 0-.005 0l.213-3.054 5.56-5.022c.24-.213-.054-.334-.373-.121l-6.869 4.326-2.96-.924c-.64-.203-.658-.64.135-.954l11.566-4.458c.538-.196 1.006.128.832.941z"/>
            </svg>
            –û—Ç–∫—Ä—ã—Ç—å Telegram –±–æ—Ç
        </a>
    </div>
    {{end}}
</div>

<!-- Photo Modal -->
<div id="photoModal" class="fixed inset-0 bg-black/80 z-50 hidden items-center justify-center p-4" onclick="closePhotoModal()">
    <div class="bg-white dark:bg-gray-800 rounded-lg max-w-6xl w-full max-h-[95vh] flex flex-col" onclick="event.stopPropagation()">
        <div id="modalContent" class="p-6 overflow-y-auto flex-1">
            <!-- Content loaded by JS -->
        </div>
        <div class="p-4 border-t border-gray-200 dark:border-gray-700 flex justify-end flex-shrink-0">
            <button onclick="closePhotoModal()" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                –ó–∞–∫—Ä—ã—Ç—å
            </button>
        </div>
    </div>
</div>
{{end}}

{{define "scripts"}}
<script>
const photosData = [
    {{range .Data}}
    {
        id: {{.ID}},
        filename: "{{.Filename}}",
        caption: {{if .Caption}}"{{.Caption}}"{{else}}""{{end}},
        takenAt: "{{formatTime .TakenAt "02.01.2006 15:04"}}",
        {{if .AuthorName}}authorName: "{{.AuthorName}}",{{end}}
        {{if .Temperature}}temperature: {{.Temperature}},{{end}}
        {{if .Humidity}}humidity: {{.Humidity}},{{end}}
        {{if .Pressure}}pressure: {{.Pressure}},{{end}}
        {{if .WindSpeed}}windSpeed: {{.WindSpeed}},{{end}}
        {{if .RainRate}}rainRate: {{.RainRate}},{{end}}
        {{if .WeatherDescription}}weatherDesc: "{{.WeatherDescription}}",{{end}}
        {{if .CameraMake}}cameraMake: "{{.CameraMake}}",{{end}}
        {{if .CameraModel}}cameraModel: "{{.CameraModel}}"{{end}}
    },
    {{end}}
];

function openPhotoModal(photoId) {
    const photo = photosData.find(p => p.id === photoId);
    if (!photo) return;

    const modal = document.getElementById('photoModal');
    const content = document.getElementById('modalContent');

    let html = `
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Photo -->
            <div class="flex items-center justify-center">
                <img src="/photos/${photo.filename}" alt="${photo.caption || ''}" class="max-w-full max-h-[75vh] lg:max-h-[80vh] object-contain rounded-lg">
            </div>

            <!-- Info -->
            <div class="space-y-4">
                ${photo.caption ? `<h3 class="text-xl font-bold text-gray-900 dark:text-white">${photo.caption}</h3>` : ''}

                <div class="grid grid-cols-1 gap-4">
            <div>
                <h4 class="font-semibold text-gray-900 dark:text-white mb-2">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–æ—Ç–æ</h4>
                <div class="space-y-2 text-sm">
                    <div class="flex items-center text-gray-600 dark:text-gray-300">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        ${photo.takenAt}
                    </div>
                    ${photo.cameraMake || photo.cameraModel ? `
                    <div class="flex items-center text-gray-600 dark:text-gray-300">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                        ${photo.cameraMake || ''} ${photo.cameraModel || ''}
                    </div>
                    ` : ''}
                    ${photo.authorName ? `
                    <div class="flex items-center text-gray-600 dark:text-gray-300">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        ${photo.authorName}
                    </div>
                    ` : ''}
                </div>
            </div>

            ${photo.temperature !== undefined ? `
            <div>
                <h4 class="font-semibold text-gray-900 dark:text-white mb-2">–ü–æ–≥–æ–¥–∞ –Ω–∞ –º–æ–º–µ–Ω—Ç —Å—ä–µ–º–∫–∏</h4>
                <div class="space-y-2 text-sm">
                    ${photo.weatherDesc ? `<p class="text-gray-600 dark:text-gray-300 mb-3">${photo.weatherDesc}</p>` : ''}
                    ${photo.temperature !== undefined ? `
                    <div class="flex justify-between">
                        <span class="text-gray-600 dark:text-gray-400">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:</span>
                        <span class="font-medium text-gray-900 dark:text-white">${photo.temperature.toFixed(1)}¬∞C</span>
                    </div>
                    ` : ''}
                    ${photo.humidity !== undefined ? `
                    <div class="flex justify-between">
                        <span class="text-gray-600 dark:text-gray-400">–í–ª–∞–∂–Ω–æ—Å—Ç—å:</span>
                        <span class="font-medium text-gray-900 dark:text-white">${photo.humidity.toFixed(0)}%</span>
                    </div>
                    ` : ''}
                    ${photo.pressure !== undefined ? `
                    <div class="flex justify-between">
                        <span class="text-gray-600 dark:text-gray-400">–î–∞–≤–ª–µ–Ω–∏–µ:</span>
                        <span class="font-medium text-gray-900 dark:text-white">${photo.pressure.toFixed(0)} –º–º —Ä—Ç.—Å—Ç.</span>
                    </div>
                    ` : ''}
                    ${photo.windSpeed !== undefined ? `
                    <div class="flex justify-between">
                        <span class="text-gray-600 dark:text-gray-400">–í–µ—Ç–µ—Ä:</span>
                        <span class="font-medium text-gray-900 dark:text-white">${photo.windSpeed.toFixed(1)} –º/—Å</span>
                    </div>
                    ` : ''}
                    ${photo.rainRate !== undefined && photo.rainRate > 0 ? `
                    <div class="flex justify-between">
                        <span class="text-gray-600 dark:text-gray-400">–î–æ–∂–¥—å:</span>
                        <span class="font-medium text-gray-900 dark:text-white">${photo.rainRate.toFixed(1)} –º–º/—á</span>
                    </div>
                    ` : ''}
                </div>
            </div>
            ` : ''}
                </div>
            </div>
        </div>
    `;

    content.innerHTML = html;
    modal.classList.remove('hidden');
    modal.classList.add('flex');
}

function closePhotoModal() {
    const modal = document.getElementById('photoModal');
    modal.classList.add('hidden');
    modal.classList.remove('flex');
}
</script>
{{end}}
