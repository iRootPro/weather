{{template "base.html" .}}

{{define "title"}}Справка - Метеостанция{{end}}

{{define "content"}}
<div class="space-y-8">
    <!-- Header -->
    <div class="bg-white rounded-lg shadow p-6">
        <h1 class="text-2xl font-bold text-gray-900 mb-2">Справка</h1>
        <p class="text-gray-600">Информация о показателях метеостанции, методах измерения и расчётов.</p>
    </div>

    <!-- Station Info -->
    <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
            <svg class="w-5 h-5 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
            </svg>
            О станции
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
            <div>
                <span class="text-gray-500">Оборудование:</span>
                <span class="ml-2 text-gray-900">Ecowitt GW3000</span>
            </div>
            <div>
                <span class="text-gray-500">Местоположение:</span>
                <span class="ml-2 text-gray-900">Армавир, Краснодарский край</span>
            </div>
            <div>
                <span class="text-gray-500">Координаты:</span>
                <span class="ml-2 text-gray-900">44.9956° с.ш., 41.1284° в.д.</span>
            </div>
            <div>
                <span class="text-gray-500">Часовой пояс:</span>
                <span class="ml-2 text-gray-900">Europe/Moscow (UTC+3)</span>
            </div>
        </div>
    </div>

    <!-- Direct Measurements -->
    <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
            <svg class="w-5 h-5 mr-2 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
            </svg>
            Прямые измерения
        </h2>

        <div class="space-y-6">
            <!-- Temperature -->
            <div class="border-l-4 border-orange-400 pl-4">
                <h3 class="font-medium text-gray-900">Температура воздуха</h3>
                <p class="text-sm text-gray-600 mt-1">Измеряется термистором в защитном кожухе с естественной вентиляцией.</p>
                <div class="mt-2 text-xs text-gray-500">
                    <span class="inline-block bg-gray-100 rounded px-2 py-1 mr-2">Единица: °C</span>
                    <span class="inline-block bg-gray-100 rounded px-2 py-1 mr-2">Точность: ±0.5°C</span>
                    <span class="inline-block bg-gray-100 rounded px-2 py-1">Диапазон: -40...+60°C</span>
                </div>
            </div>

            <!-- Humidity -->
            <div class="border-l-4 border-blue-400 pl-4">
                <h3 class="font-medium text-gray-900">Относительная влажность</h3>
                <p class="text-sm text-gray-600 mt-1">Измеряется ёмкостным датчиком. Показывает процент насыщения воздуха водяным паром.</p>
                <div class="mt-2 text-xs text-gray-500">
                    <span class="inline-block bg-gray-100 rounded px-2 py-1 mr-2">Единица: %</span>
                    <span class="inline-block bg-gray-100 rounded px-2 py-1 mr-2">Точность: ±3%</span>
                    <span class="inline-block bg-gray-100 rounded px-2 py-1">Диапазон: 1-99%</span>
                </div>
            </div>

            <!-- Pressure -->
            <div class="border-l-4 border-purple-400 pl-4">
                <h3 class="font-medium text-gray-900">Атмосферное давление</h3>
                <p class="text-sm text-gray-600 mt-1">Измеряется барометрическим датчиком. Отображается приведённое к уровню моря значение в мм рт.ст.</p>
                <div class="mt-2 text-xs text-gray-500">
                    <span class="inline-block bg-gray-100 rounded px-2 py-1 mr-2">Единица: мм рт.ст.</span>
                    <span class="inline-block bg-gray-100 rounded px-2 py-1 mr-2">Точность: ±1 мм</span>
                    <span class="inline-block bg-gray-100 rounded px-2 py-1">Норма: 760 мм рт.ст.</span>
                </div>
            </div>

            <!-- Wind -->
            <div class="border-l-4 border-teal-400 pl-4">
                <h3 class="font-medium text-gray-900">Ветер</h3>
                <p class="text-sm text-gray-600 mt-1">Скорость измеряется чашечным анемометром, направление — флюгером. Порывы — максимальная скорость за интервал.</p>
                <div class="mt-2 text-xs text-gray-500">
                    <span class="inline-block bg-gray-100 rounded px-2 py-1 mr-2">Единица: м/с</span>
                    <span class="inline-block bg-gray-100 rounded px-2 py-1 mr-2">Направление: 0-360°</span>
                    <span class="inline-block bg-gray-100 rounded px-2 py-1">Диапазон: 0-50 м/с</span>
                </div>
                <div class="mt-2 text-sm text-gray-600">
                    <span class="font-medium">Направления:</span> С, СВ, В, ЮВ, Ю, ЮЗ, З, СЗ (8 румбов по 45°)
                </div>
            </div>

            <!-- Rain -->
            <div class="border-l-4 border-cyan-400 pl-4">
                <h3 class="font-medium text-gray-900">Осадки</h3>
                <p class="text-sm text-gray-600 mt-1">Измеряются опрокидывающимся ковшом (tipping bucket). Каждое опрокидывание = 0.1 мм осадков.</p>
                <div class="mt-2 text-xs text-gray-500">
                    <span class="inline-block bg-gray-100 rounded px-2 py-1 mr-2">Единица: мм</span>
                    <span class="inline-block bg-gray-100 rounded px-2 py-1 mr-2">Разрешение: 0.1 мм</span>
                    <span class="inline-block bg-gray-100 rounded px-2 py-1">Интенсивность: мм/ч</span>
                </div>
            </div>

            <!-- Solar -->
            <div class="border-l-4 border-yellow-400 pl-4">
                <h3 class="font-medium text-gray-900">Солнечная радиация и UV</h3>
                <p class="text-sm text-gray-600 mt-1">Солнечная радиация измеряется пиранометром в Вт/м². Освещённость рассчитывается как радиация × 120 люкс.</p>
                <div class="mt-2 text-xs text-gray-500">
                    <span class="inline-block bg-gray-100 rounded px-2 py-1 mr-2">Радиация: Вт/м²</span>
                    <span class="inline-block bg-gray-100 rounded px-2 py-1 mr-2">Освещённость: люкс</span>
                    <span class="inline-block bg-gray-100 rounded px-2 py-1">UV индекс: 0-15</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Calculated Values -->
    <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
            <svg class="w-5 h-5 mr-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
            </svg>
            Расчётные показатели
        </h2>

        <div class="space-y-6">
            <!-- Dew Point -->
            <div class="border-l-4 border-blue-300 pl-4">
                <h3 class="font-medium text-gray-900">Точка росы</h3>
                <p class="text-sm text-gray-600 mt-1">Температура, при которой воздух достигает насыщения и начинается конденсация. Рассчитывается по формуле Магнуса:</p>
                <div class="mt-2 bg-gray-50 rounded p-3 font-mono text-xs overflow-x-auto">
                    α = (a × T) / (b + T) + ln(RH / 100)<br>
                    Td = (b × α) / (a - α)<br>
                    <span class="text-gray-500">где a = 17.27, b = 237.7°C, T — температура, RH — влажность</span>
                </div>
            </div>

            <!-- Feels Like -->
            <div class="border-l-4 border-orange-300 pl-4">
                <h3 class="font-medium text-gray-900">Ощущаемая температура</h3>
                <p class="text-sm text-gray-600 mt-1">Учитывает влияние ветра и влажности на восприятие температуры человеком.</p>

                <div class="mt-3 space-y-3">
                    <div class="bg-blue-50 rounded p-3">
                        <div class="text-sm font-medium text-blue-800">Wind Chill (при T ≤ 10°C и ветре ≥ 1.3 м/с)</div>
                        <div class="font-mono text-xs mt-1">
                            WC = 13.12 + 0.6215×T - 11.37×V<sup>0.16</sup> + 0.3965×T×V<sup>0.16</sup>
                        </div>
                        <div class="text-xs text-blue-600 mt-1">Охлаждающий эффект ветра на холоде</div>
                    </div>

                    <div class="bg-red-50 rounded p-3">
                        <div class="text-sm font-medium text-red-800">Heat Index (при T ≥ 27°C)</div>
                        <div class="font-mono text-xs mt-1">
                            HI = -8.78 + 1.61×T + 2.34×RH - 0.15×T×RH - ...
                        </div>
                        <div class="text-xs text-red-600 mt-1">Эффект влажности на жаре (духота)</div>
                    </div>
                </div>
            </div>

            <!-- Fog -->
            <div class="border-l-4 border-gray-300 pl-4">
                <h3 class="font-medium text-gray-900">Индикатор тумана</h3>
                <p class="text-sm text-gray-600 mt-1">Туман определяется, когда разница между температурой воздуха и точкой росы меньше порога.</p>
                <div class="mt-2 bg-gray-50 rounded p-3 font-mono text-xs">
                    Туман: (T - Td) < 1°C
                </div>
            </div>

            <!-- Rain Intensity -->
            <div class="border-l-4 border-cyan-300 pl-4">
                <h3 class="font-medium text-gray-900">Интенсивность дождя</h3>
                <p class="text-sm text-gray-600 mt-1">Классификация по скорости выпадения осадков:</p>
                <div class="mt-2 grid grid-cols-3 gap-2 text-sm">
                    <div class="bg-blue-50 rounded p-2 text-center">
                        <div class="font-medium text-blue-700">Дождь</div>
                        <div class="text-xs text-blue-600">< 2.5 мм/ч</div>
                    </div>
                    <div class="bg-blue-100 rounded p-2 text-center">
                        <div class="font-medium text-blue-800">Сильный</div>
                        <div class="text-xs text-blue-700">2.5-7.5 мм/ч</div>
                    </div>
                    <div class="bg-blue-200 rounded p-2 text-center">
                        <div class="font-medium text-blue-900">Ливень</div>
                        <div class="text-xs text-blue-800">> 7.5 мм/ч</div>
                    </div>
                </div>
            </div>

            <!-- Wind Intensity -->
            <div class="border-l-4 border-teal-300 pl-4">
                <h3 class="font-medium text-gray-900">Интенсивность ветра</h3>
                <p class="text-sm text-gray-600 mt-1">Классификация по шкале Бофорта (упрощённая):</p>
                <div class="mt-2 grid grid-cols-3 gap-2 text-sm">
                    <div class="bg-teal-50 rounded p-2 text-center">
                        <div class="font-medium text-teal-700">Ветер</div>
                        <div class="text-xs text-teal-600">5-10 м/с</div>
                    </div>
                    <div class="bg-teal-100 rounded p-2 text-center">
                        <div class="font-medium text-teal-800">Сильный</div>
                        <div class="text-xs text-teal-700">10-17 м/с</div>
                    </div>
                    <div class="bg-teal-200 rounded p-2 text-center">
                        <div class="font-medium text-teal-900">Шторм</div>
                        <div class="text-xs text-teal-800">> 17 м/с</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sun Calculations -->
    <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
            <svg class="w-5 h-5 mr-2 text-yellow-500" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 7a5 5 0 100 10 5 5 0 000-10zM2 13h2a1 1 0 100-2H2a1 1 0 100 2zm18 0h2a1 1 0 100-2h-2a1 1 0 100 2zM11 2v2a1 1 0 102 0V2a1 1 0 10-2 0zm0 18v2a1 1 0 102 0v-2a1 1 0 10-2 0zM5.99 4.58a1 1 0 00-1.41 1.41l1.06 1.06a1 1 0 001.41-1.41L5.99 4.58zm12.37 12.37a1 1 0 00-1.41 1.41l1.06 1.06a1 1 0 001.41-1.41l-1.06-1.06zm1.06-12.37a1 1 0 00-1.41 0l-1.06 1.06a1 1 0 001.41 1.41l1.06-1.06a1 1 0 000-1.41zM5.99 19.42a1 1 0 001.41 0l1.06-1.06a1 1 0 00-1.41-1.41l-1.06 1.06a1 1 0 000 1.41z"/>
            </svg>
            Расчёт солнца
        </h2>

        <p class="text-sm text-gray-600 mb-4">
            Время восхода, заката и сумерек рассчитывается по алгоритму NOAA (National Oceanic and Atmospheric Administration)
            на основе координат станции и текущей даты.
        </p>

        <div class="space-y-4">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm">
                <div class="bg-indigo-50 rounded p-3 text-center">
                    <div class="font-medium text-indigo-700">Рассвет</div>
                    <div class="text-xs text-indigo-600 mt-1">Солнце на 6° ниже горизонта</div>
                    <div class="text-xs text-gray-500 mt-1">Начало гражданских сумерек</div>
                </div>
                <div class="bg-orange-50 rounded p-3 text-center">
                    <div class="font-medium text-orange-700">Восход</div>
                    <div class="text-xs text-orange-600 mt-1">Верхний край солнца на горизонте</div>
                    <div class="text-xs text-gray-500 mt-1">С учётом рефракции (-0.833°)</div>
                </div>
                <div class="bg-red-50 rounded p-3 text-center">
                    <div class="font-medium text-red-700">Закат</div>
                    <div class="text-xs text-red-600 mt-1">Верхний край солнца на горизонте</div>
                    <div class="text-xs text-gray-500 mt-1">С учётом рефракции (-0.833°)</div>
                </div>
                <div class="bg-purple-50 rounded p-3 text-center">
                    <div class="font-medium text-purple-700">Сумерки</div>
                    <div class="text-xs text-purple-600 mt-1">Солнце на 6° ниже горизонта</div>
                    <div class="text-xs text-gray-500 mt-1">Конец гражданских сумерек</div>
                </div>
            </div>

            <div class="bg-gray-50 rounded p-4 text-sm">
                <div class="font-medium text-gray-700 mb-2">Сравнение длины дня</div>
                <p class="text-gray-600">
                    Показывается изменение продолжительности светового дня относительно вчерашнего дня,
                    недели и месяца назад. Изменение максимально в районе равноденствий (±3-4 мин/день)
                    и минимально около солнцестояний (несколько секунд).
                </p>
            </div>
        </div>
    </div>

    <!-- Data Collection -->
    <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
            <svg class="w-5 h-5 mr-2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"/>
            </svg>
            Сбор и хранение данных
        </h2>

        <div class="space-y-3 text-sm text-gray-600">
            <div class="flex items-start">
                <span class="inline-block w-2 h-2 bg-blue-400 rounded-full mt-1.5 mr-3 flex-shrink-0"></span>
                <span>Данные поступают каждые <strong>60 секунд</strong> по протоколу MQTT</span>
            </div>
            <div class="flex items-start">
                <span class="inline-block w-2 h-2 bg-blue-400 rounded-full mt-1.5 mr-3 flex-shrink-0"></span>
                <span>Хранятся в базе данных <strong>TimescaleDB</strong> (PostgreSQL с расширением для временных рядов)</span>
            </div>
            <div class="flex items-start">
                <span class="inline-block w-2 h-2 bg-blue-400 rounded-full mt-1.5 mr-3 flex-shrink-0"></span>
                <span>На графиках данные агрегируются с интервалами <strong>5 мин, 15 мин или 1 час</strong></span>
            </div>
            <div class="flex items-start">
                <span class="inline-block w-2 h-2 bg-blue-400 rounded-full mt-1.5 mr-3 flex-shrink-0"></span>
                <span>Текущие показания обновляются автоматически каждую минуту</span>
            </div>
        </div>
    </div>
</div>
{{end}}
